#! /bin/bash
rm -f *in *out*
echo " Propagators tests(AE) ..."
for i in umr ray two gss
do
  echo "   Starting $i propagators test ..."
  cp ../../templates/sample.in $i.in
  sed -i "s/XXX/density/" $i.in
  echo "\$qmc(vmc,move=$i,steps=100,block_len=10,discard=5,accept_ratio=0.5)" >> $i.in
  $AMOLQCRUN $i

  if [ $GEN == 1 ] ; then
       mv $i.out $i.$REF
       rm -f *.in
  else
   R=`grep "total energy" $i.$REF |awk {'print $4'}`
   C=`grep "total energy" $i.out |awk {'print $4'}`
      if [ $R == $C ] ; then
        echo -e "    $i propagators test \e[32mpassed.\e[39m"
        rm -f $i.in $i.out
      else
        export FAILED=1
        echo "    $i propagators test \e[31mfailed.\e[39m."
        echo "    Check $PWD/$i.out for more information."
      fi
   fi
done

